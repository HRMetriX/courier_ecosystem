name: Alert System

on:
  # Слушаем ОБА workflow как они есть
  workflow_run:
    workflows: 
      - "Parse HH Jobs"                # ТОЧНО так как в списке
      - "Publish Vacancies to Telegram" # ТОЧНО так как в списке
    types: 
      - requested
      - completed

  workflow_dispatch: {}

jobs:
  handle-alerts:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install requests
        run: pip install requests
      
      - name: Send alert
        env:
          TG_ALERT_BOT_TOKEN: ${{ secrets.TG_ALERT_BOT_TOKEN }}
          TG_ALERT_CHAT_ID: ${{ secrets.TG_ALERT_CHAT_ID }}
        run: |
          echo "Событие: ${{ github.event_name }}"
          echo "Workflow: ${{ github.event.workflow.name }}"
          echo "Статус: ${{ github.event.workflow_run.status }}"
          echo "Результат: ${{ github.event.workflow_run.conclusion }}"
          
          python scripts/alert_handler.py
